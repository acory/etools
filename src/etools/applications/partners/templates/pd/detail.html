{% extends "easy_pdf/base.html" %}
{% load humanize %}

{% block style_base %}
  {% comment %}
        See DEFAULT_CSS in https://github.com/chrisglass/xhtml2pdf/blob/master/xhtml2pdf/default.py
        for base style.
    {% endcomment %}

  {% block layout_style %}
    <style type="text/css">
        @page {
            size: "landscape";
            margin-left: 2.0cm;
            margin-right: 2.0cm;
            margin-top: 2.4cm;
            margin-bottom: 1.8cm;
            @frame header {
                -pdf-frame-content: header_content;
                margin-top: 1cm;
                margin-right: 2.0cm;
                margin-bottom: 0.3cm;
                padding-bottom: 3cm;
                margin-left: 0cm;
                background-color: #0099ff;
                height: 2cm;
            }
            @frame footer_frame {
                /* Static frame */
                -pdf-frame-content:footer_content;
                left: 50pt; width: 512pt; top: 772pt; height: 20pt;
            }
        }

        /*https://github.com/xhtml2pdf/xhtml2pdf/issues/129*/
        /*times new roman*/
        @font-face {
            font-family: "Times_New_Roman";
            src: url("{{font_path}}times_new_roman/Times_New_Roman.ttf");
        }
        @font-face {
            font-family: "Times_New_Roman_Italic";
            src: url("{{font_path}}times_new_roman/Times_New_Roman_Italic.ttf");
        }
        @font-face {
            font-family: "Times_New_Roman_Bold";
            src: url("{{font_path}}times_new_roman/Times_New_Roman_Bold.ttf");
        }
        @font-face {
            font-family: "Times_New_Roman_Bold_Italic";
            src: url("{{font_path}}times_new_roman/Times_New_Roman_Bold_Italic.ttf");
        }
    </style>
  {% endblock %}
  {% block extra_style %}
    <style type="text/css">
        <!--
          {#body {padding: 40pt}#}
          table { width: 100%; border-spacing: 0;line-height: 140%;}
          .just-border, .bordered { border: 2pt solid #A0A0A0; }
          table.bordered td { border-bottom: 2pt solid #A0A0A0; }
          table.bordered {border-bottom: none;}
          .no-border {border: none !important;}
          table.no-border td {border: none;}
          table.all-cells-border {
            border-top: 2pt solid #A0A0A0;
            border-left: 2pt solid #A0A0A0;
          }
          .all-cells-border td {
            border-bottom: 2pt solid #A0A0A0;
            border-right: 2pt solid #A0A0A0;
          }
          td {
            word-break: break-all;
            {#weird paddings fix#}
            margin-left: 5pt;
            padding-top: 2pt;
          }
          tr.bordered td { border-bottom: 2pt solid #A0A0A0;}
          .p-0 {padding: 0 !important}
          .mt-20 {margin-top: 20pt}
          .mb-5 {margin-bottom: 5pt}
          .w-p4 {width: 4%;}
          .w-p8 {width: 8%;}
          .w-p10 {width: 10%;}
          .w-p12 {width: 12.5%;}
          .w-p13 {width: 13%;}
          .w-p15 {width: 15%;}
          .w-p20 {width: 20%}
          .w-p22 {width: 22%}
          .w-p25 {width: 25%}
          .w-p30 {width: 30%}
          .w-p39 {width: 39%}
          .w-p40 {width: 40%}
          .w-p50 {width: 50%;}
          .w-p62 {width: 62.5%;}
          .w-100 {width: 100%;}
          .bold {font-weight: bold;}
          .b-gray {background-color: #E8E8E8;}
          .b-navy {background-color: #002060; color: #ffffff}
          .b-yellow {background-color: #FFE599;}
          .b-blue {background-color: #BDD6EE;}
          .p-b-20 {padding-bottom:20pt;}
          table.padded-bottom td{padding-bottom:20pt;}
          {#table.padded-top td{padding-top:20pt;}#}
          {#table.padded-left td{padding-left:20pt;}#}
          {#table.padded-right td{padding-right:20pt;}#}
          {#.risk-title {margin-block-start: 0.2rem; font-weight: bold;}#}
        -->
    </style>
  {% endblock %}
{% endblock %}

{% block content %}
  {% if error %}
    PDF could not be generated properly: <br> {{ error }}
  {% else %}
    <div id="content">
      <table class="all-cells-border">
        <tbody>
        <tr>
          <td class="b-gray w-p20">eTools ref no</td>
          <td>{{ pd.number }}</td>
        </tr>
        <tr>
          <td class="b-gray w-p20">Document Type</td>
          <td>{{ pd.get_document_type_display }}{% if pd.humanitarian_flag %} (Humanitarian){% endif %} {% if pd.contingency_pd %} (Contingency){% endif %}</td>
        </tr>
        <tr>
          <td class="b-gray w-p20">UNICEF Office</td>
          <td>{{ pd_offices|join:", " }}</td>
        </tr>
        <tr>
          <td class="b-gray w-p20">Organization Name</td>
          <td>{{ pd.agreement.partner.name }}</td>
        </tr>
        <tr>
          <td class="b-gray w-p20">Programme Title</td>
          <td>{{ pd.title }}</td>
        </tr>
        <tr>
          <td class="b-gray w-p20">Planned duration</td>
          <td>
            <span>Start date: {{ pd.start }}</span><br>
            <span>End date: {{ pd.end }}</span>
          </td>
        </tr>
        <tr>
          <td class="b-gray w-p20">Geographical coverage</td>
          <td>{{ pd_locations|join:", " }}</td>
        </tr>
        <tr>
          <td class="b-gray w-p20">Budget</td>
          <td>
            <table class="no-border">
              <tr class="">
                <td class="w-p12">UNICEF Cash:</td>
                <td class="w-p12">{{ pd.planned_budget.unicef_cash_local }}</td>
                <td class="w-p12">Supplies:</td>
                <td class="w-p12">{{ pd.planned_budget.in_kind_amount_local }}</td>
                <td class="w-p12">HQ Cash:</td>
                <td class="w-p12">{{ pd.planned_budget.total_unicef_cash_local_wo_hq }}</td>
                <td class="w-p12">Total:</td>
                <td class="w-p12">{{ pd.planned_budget.total_unicef_contribution_local }}</td>
              </tr>
              <tr>
                <td>Partner Cash:</td>
                <td>{{ pd.planned_budget.partner_contribution_local }}</td>
                <td>Supplies:</td>
                <td colspan="3">{{ pd.planned_budget.partner_supply_local }}</td>
                <td>Total:</td>
                <td>{{ pd.planned_budget.total_partner_contribution_local }}</td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td class="b-gray w-p20">Total</td>
          <td>
            <table class="no-border">
              <tr>
                <td class="w-p12">Currency:</td>
                <td class="w-p62">{{ pd.planned_budget.currency }}</td>
                <td class="w-p12">Total:</td>
                <td class="w-p12">{{ pd.planned_budget.total_local }}</td>
              </tr>
            </table>
          </td>
        </tr>
        <tbody>
      </table>

      <table class="bordered mt-20">
        <tbody>
        <tr>
          <td class="b-navy">Strategy</td>
        </tr>
        <tr>
          <td class=""><span class="bold">Context:</span> {{ pd.context }}</td>
        </tr>
        <tr>
          <td class=""><span
              class="bold">Implementation Strategy & Technical Guidance:</span> {{ pd.implementation_strategy }}
          </td>
        </tr>
        <tr>
          <td class=""><span class="bold">Capacity Development:</span> {{ pd.capacity_development }}</td>
        </tr>
        <tr>
          <td class=""><span class="bold">Other Partners involved:</span> {{ pd.other_partners_involved }}</td>
        </tr>
        <tr>
          <td class=""><span class="bold">Gender Rating: </span>{{ pd.get_gender_rating_display }} <br>
            {{ pd.gender_narrative }}
          </td>
        </tr>
        <tr>
          <td class=""><span class="bold">Equity Rating:</span> {{ pd.get_equity_rating_display }} <br>
            {{ pd.equity_narrative }}
          </td>
        </tr>
        <tr>
          <td class=""><span class="bold">Sustainability Rating:</span> {{ pd.get_sustainability_rating_display }} <br>
            {{ pd.sustainability_narrative }}
          </td>
        </tr>
        <tr>
          <td class="">
            <span class="bold">Risk & Proposed Mitigation Measures:</span><br/>
            {% for risk in pd.risks.all %}
              <span class="">{{ risk.get_risk_type_display }}: {{ risk.mitigation_measures }}</span><br/>
            {% endfor %}
          </td>
        </tr>
        <tbody>
      </table>

      <pdf:nextpage />
      <table class="all-cells-border mt-20">
        <tbody>
        <tr>
          <td colspan="2" class="b-navy">Workplan Result</td>
        </tr>
        <tr>
          <td class="b-gray w-p25">Result statement</td>
          <td class="no-border p-0" style="width: 75%;">
            <table class="all-cells-border">
              <tr>
                <td class="b-gray w-p39">Performance indicator/s</td>
                <td class="b-gray w-p13">Location</td>
                <td class="b-gray w-p13">Baseline</td>
                <td class="b-gray w-p13">Target</td>
                <td class="b-gray w-p22">Means of Verification</td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td class="b-yellow w-p25">Corresponding output from Country programme/ Humanitarian Response Plan</td>
          <td class="no-border p-0" style="width: 75%;">
            <table class="all-cells-border">
              <tr>
                <td class="b-yellow w-p39"><span>- Corresponding RAM indicator<span><br>- Xxx</td>
                <td class="b-gray w-p13"></td>
                <td class="b-gray w-p13"></td>
                <td class="b-gray w-p13"></td>
                <td class="b-gray w-p22"></td>
              </tr>
            </table>
          </td>
        </tr>
        {% for result_link in pd.result_links.all %}
          <tr>
            <td class="w-p25">
              {{ result_link.cp_output.name }}
            </td>
            <td class="no-border p-0">
              <table class="no-border">
                {% for indicator in result_link.ram_indicators.all %}
                  <tr class="no-border">
                    <td class="w-p39">{{ indicator.name }}</td>
                    {% with locations=indicator.ram_indicator.locations.all %}
                      <td class="w-p13">{% if locations.exists %}{{ ", "|join:locations }}{% else %}-{% endif %}</td>
                    {% endwith %}
                    <td class="w-p13">{{ indicator.baseline }}</td>
                    <td class="w-p13">{{ indicator.target }}</td>
                    <td class="w-p22">{{ indicator.ram_indicator.means_of_verification }}</td>
                  </tr>
                {% endfor %}
              </table>
            </td>
          </tr>
        {% endfor %}

        <tbody>
      </table>

      <table class="all-cells-border mt-20">
        <tbody>
          <tr>
            <td colspan="11" class="b-navy">Workplan Budget</td>
          </tr>
          <tr>
            <td class="b-gray w-p10">Result Level</td>
            <td class="b-gray w-p30">Result/activity</td>
            <td class="b-gray w-p20" colspan="5">Timeframe</td>
            <td class="b-gray w-p8">Total (CSO + UNICEF currency)</td>
            <td class="b-gray w-p8">CSO contribution</td>
            <td colspan="2" class="b-gray">UNICEF contribution</td>
          </tr>
          {% for result_link in pd.result_links.all %}
            {% for ll_result in result_link.ll_results.all %}
              <tr>
                <td class="b-yellow">Prog. Output 1:</td>
                <td class="b-yellow" colspan="6">
                  {{ result_link.cp_output.name }}
                  <br>
                  {{ ll_result.name }}
                </td>
                <td class="b-yellow">Sub-total output 1</td>
                <td class="b-yellow">Sub-total output 1</td>
                <td class="b-yellow w-p8">Sub-total output 1</td>
                <td class="b-yellow w-p8">Sub-total output 1</td>
              </tr>
              {% for activity in ll_result.activities.all %}
                <tr>
                  <td>{{ activity.name }}</td>
                  <td>Activity statement</td>
                  <td colspan="5">{{ activity.get_time_frames_display }}</td>
                  <td>{{ activity.cso_cash|add:activity.unicef_cash }}</td>
                  <td>{{ activity.cso_cash }}</td>
                  <td>{{ activity.unicef_cash }}</td>
                  <td>{{ activity.unicef_cash }}</td>
                </tr>
              {% endfor %}
            {% endfor %}
          {% endfor %}
          <tr>
            <td colspan="7" class="b-blue">Sub-total for the outputs</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td class="b-yellow">Prog. Output</td>
            <td colspan="6" class="b-yellow">Effective and efficient programme management</td>
            <td class="b-yellow">{{ pd.management_budgets.total }}</td>
            <td class="b-yellow">{{ pd.management_budgets.partner_total }}</td>
            <td class="b-yellow">{{ pd.management_budgets.unicef_total }}</td>
            <td class="b-yellow">{{ pd.management_budgets.unicef_total }}</td>
          </tr>
          <tr>
            <td class="b-gray">Act 4.1</td>
            <td>In-country management & support</td>
            <td colspan="5"></td>
            <td>{{ pd.management_budgets.act1_total }}</td>
            <td>{{ pd.management_budgets.act1_partner }}</td>
            <td>{{ pd.management_budgets.act1_unicef }}</td>
            <td>{{ pd.management_budgets.act1_unicef }}</td>
          </tr>
          <tr>
            <td class="b-gray">Act 4.2</td>
            <td>Operational costs</td>
            <td class="w-p4"></td>
            <td class="w-p4"></td>
            <td class="w-p4"></td>
            <td class="w-p4"></td>
            <td class="w-p4"></td>
            <td>{{ pd.management_budgets.act2_total }}</td>
            <td>{{ pd.management_budgets.act2_partner }}</td>
            <td>{{ pd.management_budgets.act2_unicef }}</td>
            <td>{{ pd.management_budgets.act2_unicef }}</td>
          </tr>
          <tr>
            <td class="b-gray">Act 4.3</td>
            <td>Planning, monitoring, evaluation, and communication</td>
            <td class="w-p4"></td>
            <td class="w-p4"></td>
            <td class="w-p4"></td>
            <td class="w-p4"></td>
            <td class="w-p4"></td>
            <td>{{ pd.management_budgets.act3_total }}</td>
            <td>{{ pd.management_budgets.act3_partner }}</td>
            <td>{{ pd.management_budgets.act3_unicef }}</td>
            <td>{{ pd.management_budgets.act3_unicef }}</td>
          </tr>
          <tr>
            <td colspan="7" class="b-blue">Sub-total for programme costs</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td colspan="7" class="b-blue">HQ support costs</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td colspan="7" class="b-blue">Total Cash budget</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        <tbody>
      </table>

      <table class="all-cells-border mt-20">
        <tbody>
        <tr>
          <td colspan="5" class="b-navy">Supply Contribution Plan</td>
        </tr>
        <tr>
          <td class="bold w-p15">Provided by</td>
          <td class="bold w-p40">Item</td>
          <td class="bold w-p15">No. of units</td>
          <td class="bold w-p15">Price/unit</td>
          <td class="bold w-p15">Total Price</td>
        </tr>
        {% for supply_item in pd.supply_items.all %}
          <tr>
            <td>{{ supply_item.get_provided_by_display }}</td>
            <td>{{ supply_item.title }}</td>
            <td>{{ supply_item.unit_number }}</td>
            <td>{{ supply_item.unit_price }}</td>
            <td>{{ supply_item.total_price }}</td>
          </tr>
        {% endfor %}
        <tr>
          <td colspan="4">Total supply Cost</td>
          <td>{{ pd.planned_budget.in_kind_amount_local }}</td>
        </tr>
        <tbody>
      </table>

      <table class="bordered mt-20">
        <tbody>
        <tr>
          <td colspan="2" class="b-navy">Others</td>
        </tr>
        <tr>
          <td class="b-gray w-p20">Partner non-financial contribution</td>
          <td>{{ pd.ip_program_contribution }}</td>
        </tr>
        <tr>
          <td class="b-gray w-p20">Cash Transfer modality</td>
          <td>{{ pd.get_cash_transfer_modalities_display }}</td>
        </tr>
        <tr>
          <td class="b-gray w-p20">Activation Protocol</td>
          <td>{{ pd.activation_protocol }}</td>
        </tr>
        <tbody>
      </table>

      <table class="just-border mt-20">
        <tbody>
          <tr>
            <td colspan="2" class="b-navy">Signatures and date</td>
          </tr>
          <tr>
            <td>
              <span>CSO Authorised Name: {% if pd.partner_authorized_officer_signatory %}{{ pd.partner_authorized_officer_signatory.user.first_name }} {{ pd.partner_authorized_officer_signatory.user.last_name }} ({{ pd.partner_authorized_officer_signatory.user.email }}){% endif %}</span><br/>
              <span>Signature:</span><br/>
              <span>Date: {{ pd.signed_by_partner_date }}</span>
            </td>
            <td>
              <span>UNICEF Authorised Name: {% if pd.unicef_signatory %}{{ pd.unicef_signatory.first_name }} {{ pd.unicef_signatory.last_name }} ({{ pd.unicef_signatory.email }}){% endif %}</span><br/>
              <span>Signature:</span><br/>
              <span>Date: {{ pd.signed_by_unicef_date }}</span>
            </td>
          </tr>
        <tbody>
      </table>
    </div>
    <div id="footer_content" style="text-align: right">
      <pdf:pagenumber/>
    </div>
  {% endif %}
{% endblock %}
